<section class="voice-shell" [ngClass]="status()">
  <header class="panel">
    <h1>Voice Ordering Assistant</h1>
    <p class="subtitle">Capture orders hands-free and review the live transcript.</p>
  </header>

  <div class="controls">
    <button
      type="button"
      class="record-btn"
      [disabled]="status() === 'submitting'"
      (click)="toggleRecording()"
    >
      <span *ngIf="status() !== 'recording'; else recordingLabel">Start Recording</span>
    </button>
    <ng-template #recordingLabel>Stop Recording</ng-template>

    <div class="visualizer">
      <div class="pulse" [style.opacity]="0.2 + recordingLevel() * 0.8"></div>
    </div>
  </div>

  <p class="status" [ngClass]="status()">
    <ng-container [ngSwitch]="status()">
      <span *ngSwitchCase="'recording'">Listening for your order…</span>
      <span *ngSwitchCase="'submitting'">Sending audio to the kitchen…</span>
      <span *ngSwitchCase="'playing'">Playing confirmation prompt…</span>
      <span *ngSwitchDefault>Tap to begin recording.</span>
    </ng-container>
  </p>

  <p class="error" *ngIf="errorMessage() as error">{{ error }}</p>
  <p class="confirmation" *ngIf="confirmationMessage() as confirmation">{{ confirmation }}</p>

  <section class="transcript">
    <h2>Live Transcript</h2>
    <ng-container *ngIf="transcript | async as messages">
      <ul class="transcript-list" *ngIf="messages.length; else waiting">
        <li *ngFor="let message of messages" class="transcript-message" [ngClass]="message.role">
          <span class="speaker" aria-hidden="true">{{ message.role === 'user' ? 'Customer' : 'Assistant' }}</span>
          <p>{{ message.text }}</p>
        </li>
      </ul>
    </ng-container>
    <ng-template #waiting>
      <p class="transcript-text">Waiting for speech…</p>
    </ng-template>
  </section>
</section>
