<section class="voice-shell" [ngClass]="status()">
  <header class="panel">
    <h1>Voice Ordering Assistant</h1>
    <p class="subtitle">Capture orders hands-free and review the live transcript.</p>
  </header>

  <div class="controls">
    <button
      type="button"
      class="record-btn"
      [disabled]="status() === 'submitting'"
      (click)="toggleRecording()"
    >
      <span *ngIf="status() !== 'recording'; else recordingLabel">Start Recording</span>
    </button>
    <ng-template #recordingLabel>Stop Recording</ng-template>

    <div class="visualizer">
      <div class="pulse" [style.opacity]="0.2 + recordingLevel() * 0.8"></div>
    </div>
  </div>

  <p class="status" [ngClass]="status()">
    <ng-container [ngSwitch]="status()">
      <span *ngSwitchCase="'recording'">Listening for your order…</span>
      <span *ngSwitchCase="'submitting'">Sending audio to the kitchen…</span>
      <span *ngSwitchCase="'playing'">Playing confirmation prompt…</span>
      <span *ngSwitchDefault>Tap to begin recording.</span>
    </ng-container>
  </p>

  <p class="error" *ngIf="errorMessage() as error">{{ error }}</p>
  <p class="confirmation" *ngIf="confirmationMessage() as confirmation">{{ confirmation }}</p>

  <section class="transcript">
    <h2>Live Transcript</h2>
    <p class="transcript-text">{{ (recognizedText | async) || 'Waiting for speech…' }}</p>
  </section>

  <section class="slots" *ngIf="(slots | async) as slots">
    <h2>Order Slot Progress</h2>
    <dl>
      <div>
        <dt>Product</dt>
        <dd>{{ slots.product.name || 'Pending' }}</dd>
      </div>
      <div>
        <dt>Variant</dt>
        <dd>{{ slots.variant.name || (slots.variant.isFilled ? 'Default' : 'Pending') }}</dd>
      </div>
      <div>
        <dt>Quantity</dt>
        <dd>{{ slots.quantity.quantity ?? (slots.quantity.isFilled ? 'Unknown' : 'Pending') }}</dd>
      </div>
      <div>
        <dt>Modifiers</dt>
        <dd>
          <ng-container *ngIf="slots.modifiers.isFilled; else modifierPending">
            {{ slots.modifiers.isExplicitNone ? 'No modifiers' : (slots.modifiers.selections.map((m) => m.name).join(', ') || 'Pending') }}
          </ng-container>
          <ng-template #modifierPending>Pending</ng-template>
        </dd>
      </div>
      <div>
        <dt>Pickup Time</dt>
        <dd>{{ slots.pickupTime.value || (slots.pickupTime.isFilled ? 'Set' : 'Pending') }}</dd>
      </div>
    </dl>
  </section>
</section>
